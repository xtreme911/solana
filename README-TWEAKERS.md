TWEAKING 

YOU CAN TWEAK YOUR BUILD TO COMPILE FOR CPU SPECIFIC ARCHITECTURE BY USING A RUSTFLAG 

TO FIND OUT WHAT ARCHITECTURE YOUR CPU HAS THEN GO TO THE SERVER YOU ARE BUILDING FOR VALIDATING AND RUN THIS COMMAND AS THE SOLANA USERNAME THAT YOU ARE RUNING THE SOLANA VALIDATING SOFTWARE

FIRST INSTALL RUST IF YOU HAVE NOT ALREADY

    apt update && apt upgrade && apt install libudev-dev 
    
    curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

NOW BE SURE TO SOURCE YOUR ENVIRONMENT VARIABLE SO YOUR PATH ENVIRONMENT VARIABLE HAS THE CARGO BIN DIRECTORY

    source ~/.cargo/env
    
NOW RUN THIS RUSTC COMMAND TO READ THE OUTPUT IN CONSOLE

    rustc --target=x86_64-unknown-linux-gnu --print target-cpus

CONSOLE TEXT WILL BE SOMETHING LIKE THIS BELOW 

    Available CPUs for this target:
        native         - Select the CPU of the current host (currently znver2).   
        alderlake     
        amdfam10      
        athlon        
        ...

AND YOU MUST LOOK AT THE PART THAT IS ON THE FIRST LINE WHICH WILL BE THE native OR CURRENTLY INSTALLED CPU IN THIS SYSTEM. AT THE END OF THIS native LINE IT WILL SAY IN PARENTHISES (currently XXXXX) AND THIS TEXT WILL BE WHERE THE XXXX IS LOCATED SO FOR MY SERVER I GOT THE VALUE OF znver2 ARCHITECTURE. 


SO THAT IS ALL YOU HAVE TO DO IS ADD THAT TO THE EXPORT LINE AND PUT THAT EXPORT LINE RIGHT BEFORE THE solbuild.sh FILE LINE WITH THE cargo-install-all.sh CALL.


LIKE SO FOR THE AMD EPYC CPU IN MY SERVER, I HAVE TO ADD THIS LINE:

    export RUSTFLAGS="-C target-cpu=znver2"

SO YOU MUST EDIT YOUR solbuild.sh FILE BY HAND USING nano solbuild.sh AND INSERT THIS RUSTFLAG EXPORT RIGHT BEFORE THE CARGO COMPILE CALL IN THE SCRIPT LIKE BELOW. 

SEE HOW THE EXPORT LINE IS JUST ABOVE THIS cargo-install-all.sh SHELL SCRIPT? THAT IS THE SHELL SCRIPT THAT DOES THE COMPILING SO IT HAS TO BE INSERTED BEFORE THAT LINE AT ANY POINT REALLY. JUST PUT IT RIGHT IN FRONT SO YOU ARE SURE YOU DON'T MAKE ANY MISTAKES. :)

HERE IS THE WAY IT SHOULD LOOK IN YOUR solbuild.sh FILE AFTER YOU INSERT THE CORRECT CPU EXPORT LINE INSIDE OF IT:

    (some previous lines in file are here)
    
    export RUSTFLAGS="-C target-cpu=znver2" 
    ~/solana/scripts/cargo-install-all.sh ~/.local/share/solana/install/active_release
    
    (some following lines in file are here)
    
DO THIS BEFORE YOU RUN THIS solbuild.sh SCRIPT PLEASE OR THIS WILL NOT GET UTILIZED IN THE COMPILE.

